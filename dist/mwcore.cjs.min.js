/*!
* @ferry-middleware/ferry-mw-core with v0.1.0
* Author: yanpan
* Built on 2022-05-28, 19:44:14
* Released under the MIT License Copyright (c) 2022
*/
"use strict";var t=function(){function t(t){this.middlewares=[],this._updateChain(),this.setHttp(t)}return t.prototype.setHttp=function(t){var e=this;return this.unsetHttp(),t&&(this.http=t,this.originalAdapter=t.defaults.adapter,t.defaults.adapter=function(t){return e.adapter(t)}),this},t.prototype.unsetHttp=function(){return this.http&&(this.http.defaults.adapter=this.originalAdapter,this.http=null),this},t.prototype.has=function(t){return this.middlewares.indexOf(t)>-1},t.prototype.register=function(t){var e=this;return Array.isArray(t)||(t=[t]),t.forEach((function(t){if(t){if(e.has(t))throw new Error("Middleware already registered");e.middlewares.push(t),e._addMiddleware(t)}})),this},t.prototype.unregister=function(t){if(t){var e=this.middlewares.indexOf(t);e>-1&&this.middlewares.splice(e,1),this._updateChain()}return this},t.prototype.reset=function(){return this.middlewares.length=0,this._updateChain(),this},t.prototype.adapter=function(t){return this.chain.reduce((function(t,e){var r=e[0],n=e[1];return t.then(r,n)}),Promise.resolve(t))},t.prototype._addMiddleware=function(t){this.chain.unshift([t.onRequest&&function(e){return t.onRequest(e)},t.onRequestError&&function(e){return t.onRequestError(e)}]),this.chain.push([t.onResponse&&function(e){return t.onResponse(e)},t.onResponseError&&function(e){return t.onResponseError(e)}])},t.prototype._updateChain=function(){var t=this;this.chain=[[function(e){return t._onSync(t.originalAdapter.call(t.http,e))},void 0]],this.middlewares.forEach((function(e){return t._addMiddleware(e)}))},t.prototype._onSync=function(t){return this.middlewares.reduce((function(t,e){return e.onSync?e.onSync(t):t}),t)},t}(),e={Service:t,version:"0.1.0"};module.exports=e;